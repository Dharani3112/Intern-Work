{% extends "base.html" %}

{% block title %}Edit Product{% endblock %}

{% block content %}
<div class="main-content">
    <div class="form-container">
        <h2 class="section-title">Edit Product: {{ product.name }}</h2>
        
        <form method="POST" class="product-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="name" class="form-label">Product Name *</label>
                    <input type="text" class="form-input" id="name" name="name" 
                           value="{{ product.name }}" required>
                </div>
                <div class="form-group">
                    <label for="brand" class="form-label">Brand</label>
                    <input type="text" class="form-input" id="brand" name="brand" 
                           value="{{ product.brand or '' }}">
                </div>
            </div>

            <div class="form-group">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-input" id="description" name="description" rows="3">{{ product.description or '' }}</textarea>
            </div>

            <div class="form-group">
                <label for="specifications" class="form-label">Specifications</label>
                <textarea class="form-input" id="specifications" name="specifications" rows="2" 
                          placeholder="e.g., Bluetooth 5.0, 30-hour battery, Water resistant">{{ product.specifications or '' }}</textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="price" class="form-label">Price ($) *</label>
                    <input type="number" class="form-input" id="price" name="price" 
                           step="0.01" min="0" value="{{ product.price }}" required>
                </div>
                <div class="form-group">
                    <label for="stock" class="form-label">Stock Quantity</label>
                    <input type="number" class="form-input" id="stock" name="stock" 
                           min="0" value="{{ product.stock }}">
                </div>
                <div class="form-group">
                    <label for="delivery_date" class="form-label">Delivery Days</label>
                    <input type="number" class="form-input" id="delivery_date" name="delivery_date" 
                           min="1" value="{{ product.delivery_date or 7 }}">
                </div>
            </div>            <div class="form-group">
                <label for="category" class="form-label">Category</label>
                <select class="form-input" id="category" name="category" onchange="handleCategoryChange(this)">
                    <option value="">Select Category</option>
                    {% for category in categories %}
                    <option value="{{ category }}" {% if product.category == category %}selected{% endif %}>{{ category }}</option>
                    {% endfor %}
                    {% if product.category and product.category not in categories %}
                    <option value="{{ product.category }}" selected>{{ product.category }}</option>
                    {% endif %}
                    <option value="__new_category__">+ Add New Category</option>
                </select>
                <input type="text" class="form-input" id="new_category" name="new_category" 
                       placeholder="Enter new category name" style="display: none; margin-top: 0.5rem;">
                <div class="form-help">
                    Select an existing category or choose "Add New Category" to create a new one.
                </div>
            </div>

            <div class="form-group">
                <label for="image_url" class="form-label">Main Image URL</label>
                <input type="url" class="form-input" id="image_url" name="image_url" 
                       value="{{ current_image_url }}" placeholder="https://example.com/image.jpg">
                <div class="form-help">
                    You can use free images from <a href="https://unsplash.com" target="_blank">Unsplash</a> 
                    or <a href="https://pixabay.com" target="_blank">Pixabay</a>
                </div>
                {% if current_image_url %}
                <div class="image-preview">
                    <small class="preview-label">Current image:</small>
                    <img src="{{ current_image_url }}" alt="Current product image" class="current-image">
                </div>
                {% endif %}
            </div>            <div class="form-actions">
                <a href="{{ url_for('admin_dashboard') }}" class="view-product-btn">Cancel</a>
                <button type="submit" class="add-to-cart-btn">Update Product</button>
            </div>
        </form>
    </div>
</div>

<script>
function handleCategoryChange(select) {
    const newCategoryInput = document.getElementById('new_category');
    
    if (select.value === '__new_category__') {
        newCategoryInput.style.display = 'block';
        newCategoryInput.required = true;
        newCategoryInput.focus();
        // Clear the category name to prevent submission of '__new_category__'
        select.name = '';
        newCategoryInput.name = 'category';
    } else {
        newCategoryInput.style.display = 'none';
        newCategoryInput.required = false;
        newCategoryInput.value = '';
        select.name = 'category';
        newCategoryInput.name = 'new_category';
    }
}
</script>
{% endblock %}